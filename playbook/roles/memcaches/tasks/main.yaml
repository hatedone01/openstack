---
- name: Install commem packet
  ansible.builtin.package:
    name: 
      - memcached
      - python3-memcache
    state: present

- name: Add memcaches ip to memcached.conf
  ansible.builtin.lineinfile:
    path:  /etc/memcached.conf
    regexp: '^-l 127.0.0.1'
    line: -l {{ item }}
  with_items: "{{ hostvars[host]['ansible_hosts_mgmt'] }}"

- name: Start memcaches
  ansible.builtin.service:
    name: memcached
    state: started

- name: Enable memcaches
  ansible.builtin.service:
    name: memcached
    enabled: yes